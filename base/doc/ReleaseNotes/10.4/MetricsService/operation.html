<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
"http://www.w3.org/TR/REC-html40/loose.dtd">

<html> <head>
<title>Metric Service Operation</title>
</head>

<body>
<h2>Operations</h2>

<p>
      Release 10.4 contains servlets that display metrics data about
      the traffic and CPU load generated by agents and the capacity of
      underlying resource.  These servlets are useful for
      understanding the real-time performance of the society and for
      debugging. Also, These servlets are good
      <a href="usecases.html" target="contents">example code</a> 
      for more complex uses of the metrics services.
<p> This section describes how to interpret the output of the
     Metrics Servlets. Remember that the Metrics service captures the
      current status of the society from a Node's point of view, i.e
      the metrics service is the Node's best guess of what is going on
      at a system level ----<b> NOW </B>

<p>
<h3>Colorized Table Entries</h3>
    The table entries are colorized to show three features of
    its metric at the same time. In addition the table entry are mouse
    sensitive and all the metric's attributes are displayed on the browser's
    mouse line. 
    <dl>
      <dt><b>Metric Value</b></dt>
      <dd> The value of the metric is displayed as text</dd>
      <dt><b>Metric Credibility</b></dt>
      <dd>The credibility of the metric indicates how much to believe
	that the value is true. Credibility takes into account a lot
	of factors, such as when, how, by whom a measurement was
	made. For servlet display purposes the credibility is divided
	into three bins, change how dark the text is displayed,
	i.e. the darker the more credible (see columns in example
	table below).
	<ul>
	  <li><b>Light Gray</b> indicates that the metric value was only
	    determined as a compile-time default. </li>

	  <li><b>Gray</b> indicates that the metric value was obtained from a
	    configuration file. </li>
	  <li><b>Black</b> indicates that the metric value was obtained
	    from a run-time measurement.</li>
	  </ul>
      </dd>
      <dt><b>Value Threshold</b></dt>
      <dd>When the value of a metric crosses a threshold, its value may be
	interesting and may warrant attention. The rows of the table show
	three color backgrounds, which show the relationship between the metric
	value and threshold.
	<ul>
	  <li><b>Green</b> background indicates that the value
	    is in the normal range. </li>
	  <li><b>Yellow</b> background indicates that the
	    values is in a typical ground state, i.e nothing is happening.
	  <li><b>Red</b> background indicates that the value has
	    crossed a metric specific threshold and may be interesting.</li>
	</ul>
      </dd>
    </dl>
  <table>
  <caption align=bottom><i>Color Key</i></caption>
  <tr><td>
      <img src="gifs/ColorTable.gif">
  </td></tr>
</table>

<p>
<h3>/metrics/remote/agent</h3>
This servlet shows the status of resources along the path for
    communications from any agent on the node to a specific
    agent. This servlet is useful for debugging. For example, if the
    Queue length is greater than one, then messages are backed up
    waiting to be transmitted to the agent. Since messages are
    usually sent right away this indicates a problem along the
    path. Likewise, if he Node has not HeardFrom an agent recently,
    the agent or its node may have failed.  Also, the table show the
    capacity of the network path  to the agent and the agent's host
    capacity. 
    
<p>
<table>
  <caption align=bottom><i>Remote Agent Status Servlet</i></caption>
  <tr><td>
      <img src="gifs/RemoteStatusServlet.gif">
  </td></tr>
</table>

<dl> 
      <dt><b>Spoke To</b></dt>
	<dd>number of seconds since this node has spoke to this agent. </dd>
      <dt><b>Heard From</b></dt> 
	<dd>number of seconds since something has heard from this
	agent (includes other node via gossip)</dd>
      <dt><b>Spoke Error</b> </dt> 
      <dd> number of seconds since the last communication error</dd>
      <dt><b>Queue</b> </dt> 
	<dd>instantaneous queue length for messages waiting to be sent to
	agent. (Includes messages in the process of being sent)</dd>
      <dt><b>MsgTo</b> </dt> 
      <dd>message per second from all agents on this node to agent</dd>
      <dt><b>MsgFrom</b> </dt> 
      <dd>messages per second from agent to any agent on this node</dd>
      <dt><b>eMJIP</b> </dt> 
      <dd> effective Million Java Instruction Per Second that a single
	thread on the agent host.</dd>
      <dt><b>mKbps</b> </dt> 
      <dd>maximum kilobits per second for the network path between
	this node and the agent</dd>
      <dt><b>eKbps</b> </dt> 
      <dd>expected kilobits per second for the network path between
	this node and the agent</dd>
    </dl>

<p>
<h3>/metrics/agent/load</h3> 
    This servlet shows the amount of resource
    consumption for each agent and service that is resident to this
    node. The resources include CPU, Communications, and Storage. This
    servlet is used to see which agents are resident on the node and
    their level of activity. The metrics are all average rates over
    the averaging interval.
<p>
<table>
  <caption align=bottom><i>Agent Load Servlet</i></caption>
  <tr><td>
      <img src="gifs/AgentLoadServlet.gif">
  </td></tr>
</table>

    <dl>
      <dt><b>CPULoadAvg</b> </dt> 
      <dd>Average number of thread
      servicing the agent. For example, a load average of 2, means
      that two threads were servicing the agent for the whole
      averaging interval. This is unlikely and is a indicator that one
      of the Agent's plugins is inappropriately holding onto a thread
      during a sleep, or wait for I/O</dd>
      <dt><b>CPULoadMJIPS</b> </dt> 
      <dd>Average rate of CPU used servicing the agent. This is the integration 
	load average * the effective cpu. </dd>
      <dt><b>MsgIn</b></dt> 
      <dd>Message Per Second from all agent to this agent</dd>
      <dt><b>MsgOut</b></dt> 
      <dd>Message Per Second from this agent to all other agents </dd>
      <dt><b>BytesIn</b></dt> 
      <dd>Bytes Per Second from all agent to this agent </dd>
      <dt><b>BytesOut</b></dt> 
      <dd>Bytes Per Second from this agent to all agent </dd>
      <dt><b>PersistSize</b></dt> 
      <dd>Size of the last Agent Persist </dd>
    </dl>

<p>
<h3>/metrics/host/resources</h3>
This servlet shows the status of Host resources for the Node.
The most of basic values come from polling  Linux /proc. MJIPS
    (Million Java Instructions per Second) comes from running
    benchmark.
<p>
<table>
  <caption align=bottom><i>Node Resources Servlet</i></caption>
  <tr><td>
      <img src="gifs/NodeResourceServlet.gif">
  </td></tr>
</table>
<p>
    <dl>
      <dt><b>EffectiveMJips</b></dt> 
      <dd>Effective CPU that one thread will experience. This is a
	model of the Linux CPU scheduling algorithm. The model takes
	into account the number of CPUs, MJIPS for each CPUs, and the
	load average of the host. </dd>
      <dt><b>Load Average</b></dt> 
      <dd>Host Load Average is the number of processes running in
	Host.  </dd>
      <dt><b>Count</b></dt> 
      <dd>Number of Processors </dd>
      <dt><b>TCP In Use</b></dt> 
      <dd>The number of TCP Sockets</dd>
      <dt><b>UDP In Use</b></dt> 
      <dd>The number of UDP Sockets</dd>
      <dt><b>Total Memory</b></dt> 
      <dd>Host Memory </dd>
      <dt><b>Free Memory</b></dt> 
      <dd> </dd>
      <dt><b>Cache</b></dt> 
      <dd>Size of a CPU's level 2 cache</dd>
    </dl>

<p>
<h3>/message/statistics</h3>
This servlet summarizes the Messages statistics for communications out
    of all agents in this node. This is a raw dump of the legacy MTS
    Message Statistics Service and does not use the Metrics service. 
<p>
<table>
  <caption align=bottom><i>Message Statistics Servlet</i></caption>
  <tr><td>
      <img src="gifs/MessageStatisticsServlet.gif">
  </td></tr>
</table>
<dl>
  <dt><b>AvgQueueLength</b></dt> 
      <dd>Average of the number of messages waiting on all Destination
      Links. The average is calculated using a decaying average</dd>
      <dt><b>Total Bytes</b></dt> 
      <dd>Count of the number of bytes set from all agents on this
	node. This statistic does not include inter-node messages,
	which are not serialized</dd>
      <dt><b>Total Count</b></dt> 
      <dd>Count of Messages sent from all agents on this node. This
	count includes both inter-node messages and intra-node messages</dd>
      <dt><b>Message Length Histogram</b></dt> 
      <dd>Count of Messages sent from all agents on this node,
	organized by size. The bins are labeled by the max size in
	the bin </dd>
    </dl>

<p>
<h3>/message/local/agents</h3>
This servlet displays status of communications from an agent on this
    node to ALL other agents in the society.
    The servlet is a dump of the RAW contents of the Agent Status Service and
    does not use the Metrics Service.
<p>
<table>
  <caption align=bottom><i>Remote Agent Messages Servlet</i></caption>
  <tr><td>
      <img src="gifs/RemoteAgentServlet.gif">
  </td></tr>
</table>
<p>

<h3>/message/remote/agents</h3>
This servlet displays status of communications from an agent in the
society to ALL agents on this node. The servlet is a dump of the RAW
contents of the Agent Status Service and does not use the Metrics
Service.
<p>
<table>
  <caption align=bottom><i>Local Agent Messages Servlet</i></caption>
  <tr><td>
      <img src="gifs/LocalAgentServlet.gif">
  </td></tr>
</table>




</body>

</html>




