<html>
<head><title>Cougaar Logging Service</title></head>
<body bgcolor=white>
<h2>Cougaar Logging Service</h2>
<p>
Cougaar provides a standardized logging service to all components.  The
logging support includes a "LoggingService", which is used by components
to append to the log, and configuration utilities to customize the logger:
set logging levels, set logging destinations, etc.
<p>
The LoggingService is the most important API for component developers.
This service can be obtained through the ServiceBroker, just like any
other service -- see the section on use of the ServiceBroker for further
details.  For example, this is an easy way to obtain the logger during
component load-time:
<pre>
   import org.cougaar.core.service.LoggingService;
   ...
     private LoggingService log;
     public void setLoggingService(LoggingService log) {
       this.log = log;
     }
</pre>
Currently a component can only obtain a log with its classname as the
log category name; i.e. log messages written by the component will be
identified by the component classname.
<p>
The LoggingService defines 5 logging levels:
<pre>
   DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL
</pre>
and three generic methods:
<pre>
   /** @return true if the logger is enabled at the given level */
   public boolean isEnabledFor(int level);

   /** Append the given message to the log at the given level.  */
   public void log(int level, String message);

   /** Append both the given message and exception at the given level.  */
   public void log(int level, String message, Throwable t);
</pre>
plus there are short-cut methods for all the levels:
<pre>
   /** Equivalent to "isEnabledFor(DEBUG)" */
   public boolean isDebugEnabled();

   /** Equivalent to "log(DEBUG, message)" */
   public void debug(String message);

   /** Equivalent to "log(DEBUG, message, t)" */
   public void debug(String message, Throwable t);

   // ditto for all the other levels (isInfoEnabled(), etc)
</pre>
<p>
As noted above, all logging statements specify a logging level, and 
if the logger is configured at a level &gt;= to the specified 
level then the logging message is appended to the log.
<p>
A general guide to logging levels is:
<ul>
  <li>use DEBUG for code-level developer details that are
      just for code debugging</li>
  <li>use INFO for user-level "verbose" details that may be 
      of interest but can be ignored</li>
  <li>use WARN for user-level warnings that are important 
      but ignorable</li>
  <li>use ERROR for significant problems (exceptions, etc)
      that can't be recovered from</li>
  <li>only use FATAL for violations of major assumptions</li>
</ul>
<p>
<b>Make sure</b> to wrap all "log(..)" calls with the related
"is*Enabled(..)" check.  For example, use:
<pre>
   if (log.isDebugEnabled()) {
     log.debug("some message");  // good
   }
</pre>
instead of just using:
<pre>
   log.debug("some message");  // <b>wasteful!</b>
</pre>
This is most important when the log message requires the 
creation of a new String, such as:
<pre>
   log.debug("cons together "+this+" plus other args "+i+", etc");
</pre>
since the above string-creation will incur a runtime memory and
performance cost whether or not the logger is at the DEBUG 
level.  In practice this can be a significant performance 
penalty.
<p>
The LoggingService API is essentially a subset of the 
<a href="http://jakarta.apache.org/log4j">log4j</a> API, but the
LoggingService API itself is not compile-time dependent upon log4j.
In the future the underlying implemention may be modified to use
Sun's JSR47, so LoggingService clients shouldn't make log4j 
assumptions when using the LoggingService.
<p>
By default Cougaar will write all logging calls at WARN or
higher to system-out, in a form like:
<pre>
   2002-03-08 22:26:34,898 WARN [YourClass] - your message
</pre>
This can be configured at node creation time by setting "-D"
system properties.  Currently these properties use log4j-style
statements, and the underlying LoggingService implementation
uses log4j.  Logging configuration can assume that log4j is 
in use.
<p>
The system properties are:
<ul>
  <li>"-Dorg.cougaar.core.logging.config.filename=FILE"<br>
      Specify a log4j property filename, which is found
      using the ConfigFinder.</li><p>
  <li>"-Dorg.cougaar.core.logging.NAME=VALUE<br>
      Pass the given "NAME=VALUE" to override the above FILE
      contents.</li>
</ul>
Note that if you use any of the above 
"-Dorg.cougaar.core.logging.*" properties then you must fully
specify the logging configuration.
<p>
Here is a minimal log4j property file that matches the Cougaar
default logging configuration:
<pre>
  log4j.rootCategory=WARN,A1
  log4j.appender.A1=org.apache.log4j.ConsoleAppender
  log4j.appender.A1.layout=org.apache.log4j.PatternLayout
  log4j.appender.A1.layout.ConversionPattern==%d{ABSOLUTE} %-5p - %c{1} - %m%n
</pre>
<p>
The logging level is set to a default level with the 
"log4j.rootCategory=.." line.  The level for individual packages can 
changed by adding "log4j.category.PACKAGE=LEVEL" lines, such as:
<pre>
  ...
  # set the level to "info" for all "org.cougaar.core.*" subpackages:
  log4j.category.org.cougaar.core=INFO
</pre>
This can be used to turn the level up or down from the root level.  As
noted above, logging levels are "inherited" down the package hierarchy.
The level can also be set for a specific class, which must be the
"service-requestor" that obtained the logging service:
<pre>
  ...
  # debug your "com.foo.MyPlugin":
  log4j.category.com.foo.MyPlugin=DEBUG
</pre>
In some cases you may need to specify the category name:
<pre>
  log4j.category.org.cougaar.core=INFO,A1
</pre>
<p>
Additional documentation on log4j configuration is provided in
<a href="http://jakarta.apache.org/log4j/docs/manual.html"
>the log4j manual</a> and 
<a href="http://www.javaworld.com/javaworld/jw-11-2000/jw-1122-log4j_p.html"
>this additional overview</a>.
<p>
Log4j supports many open-source log appenders and log 
visualizers.  For example, log4j can be configured to stream
logging statements over sockets.  Log visualizers include
<a href="http://traxel.com/lumbermill">the lumbermill UI</a>.
<p>
For Cougaar 9.0 there is minimal support to change logging 
levels and appenders at runtime.  The "LoggingControlService"
is overly limited, and will likely be redesigned in a future
Cougaar release.
<p>
Cougaar also has a non-service logging API, 
"org.cougaar.util.log", which can be used by external 
applications such as CSMART.
</body>
</html>
