@echo off
 
REM "<copyright>"
REM " "
REM " Copyright 2001-2004 BBNT Solutions, LLC"
REM " under sponsorship of the Defense Advanced Research Projects"
REM " Agency (DARPA)."
REM ""
REM " You can redistribute this software and/or modify it under the"
REM " terms of the Cougaar Open Source License as published on the"
REM " Cougaar Open Source Website (www.cougaar.org)."
REM ""
REM " THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS"
REM " "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT"
REM " LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR"
REM " A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT"
REM " OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,"
REM " SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT"
REM " LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,"
REM " DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY"
REM " THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT"
REM " (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE"
REM " OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE."
REM " "
REM "</copyright>"

REM ""
REM "Launch a Cougaar node"
REM ""

IF NOT "%1" == "" GOTO L_2
ECHO Usage: $0 [-v] XML_NAME [NODE_NAME]
ECHO.
ECHO -v         Verbose output
ECHO XML_NAME   Society configuration file
ECHO NODE_NAME  Node name, defaults to first node in file
GOTO L_END
:L_2

SET VERBOSE=OFF
IF NOT "%1" == "-v" GOTO L_3
SET VERBOSE=ON
SHIFT
:L_3

SET XML=%1
SET NODE=
IF "%2" == "" GOTO L_4
SET NODE=-param node %2
:L_4

IF NOT "%CIP%" == "" GOTO L_5
SET CIP=%COUGAAR_INSTALL_PATH%
:L_5
SET XSL=%CIP%\bin\xsl_node.xsl

REM "create temporary script file for our %cmd%"
SET EXEC=xslnode_exec.bat
IF EXIST %EXEC% DEL %EXEC%
ECHO @ECHO %VERBOSE% >> %EXEC%
ECHO @REM Generated by XSLNode.bat! >> %EXEC%

REM "We would like to allow prefix/append overrides, but DOS lacks"
REM "an echo that omits the trailing newline (i.e. `echo -n`) and"
REM "the '>>' appends a newline (unlike bash), so we can't do something like:"
REM "  echo -n java -Dfoo=before \\ >> %EXEC%"
REM "  java ..xsl.. >> %EXEC%"
REM "  echo -n -Dbar=after >> %EXEC%"
REM "At best, we'd need to add custom XSL params:"
REM "  -param pre1 -Djava.before -param post1 -Dbar=after"
REM "manually edit the generated '%EXEC%' file, or use cygwin tools!"

SET WIN=-param os windows -param java java.exe

java org.apache.xalan.xslt.Process -in %XML% -xsl %XSL% %WIN% %NODE% >> %EXEC%

CALL %EXEC%

@ECHO OFF
REM "we reach this point if the above is CTRL-C'd"

DEL %EXEC%

:L_END
